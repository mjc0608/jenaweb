<html>  
  <head>  
        <meta charset="utf-8">  
        <title>coauthor</title>  
  </head> 
      <style>
    .MyTip {
    position: absolute;
    width: auto;
    height: auto;
    font-family: Verdana;
    font-size: 18px;
    text-align: center;
    border-style: solid;
    border-width: 0.4px;
    background-color: white;
    border-radius: 0.5px;
    }
    </style>

<style>


</style>
    <body>  
		<script src="/d3.v3.min.js" charset="utf-8"></script>
        <script>		   
					   
        var nodes = [${nodes}];
        var edges = [${edges}];
		
		var width = 4000;
		var height = 4000;
		
		
		var svg = d3.select("body")
					.append("svg")
					.attr("width",width)
					.attr("height",height);
		
		var force = d3.layout.force()
				.nodes(nodes)		//指定节点数组
				.links(edges)		//指定连线数组
				.size([width,height])	//指定范围
				.linkDistance(150)	//指定连线长度
				.charge(-400);	//相互之间的作用力

		force.start();	//开始作用

		console.log(nodes);
		console.log(edges);

        var tip = d3.select("body").append("div")
                  .attr("class", "Mytip")
                  .attr("opacity", 0)
                  .attr("stroke-opacity", 0);
		
		//添加连线		
		var svg_edges = svg.selectAll("line")
							.data(edges)
							.enter()
							.append("line")
							.style("stroke","#ccc")
							.style("stroke-width", function(d) {
								return d.value;
							})
                            .on("mouseover", function (d) {
                                tip.html(d.value + " times")
                                    .style("left", (d.source.x + d.target.x) / 2 +11)
                                    .style("top", (d.source.y + d.target.y) / 2 + 11)
                                    .style("opacity", 1.0);
                            })
                            .on("mousemove", function (d) {
                                tip.style("left", (d.source.x + d.target.x) / 2 +11)
                                    .style("top", (d.source.y + d.target.y) / 2 + 11)
                                    .style("opacity", 1.0);
                            })
                            .on("mouseout", function (d) {
                                tip.transition()
                                    .duration(1000).style("opacity", 0.0);
                                window.setTimeout(function () {
                                    tip.style("left", 0)
                                        .style("top", 0)
                                }, 1000)
                            });

		var color = d3.scale.category20();
				
		//添加节点			
		var svg_nodes = svg.selectAll("circle")
							.data(nodes)
							.enter()
							.append("circle")
							.attr("r",20)
							.style("fill",function(d,i){
								return color(i);
							})
							.on("mouseover", function (d) {
			                 	highlightNode(d.index);
			                 })
							.call(force.drag);

		//添加描述节点的文字
		var svg_texts = svg.selectAll("text")
							.data(nodes)
							.enter()
							.append("text")
							.style("fill", "black")
							.attr("dx", 20)
							.attr("dy", 8)
							.text(function(d){
								return d.name;
							});
					

		force.on("tick", function(){	//对于每一个时间间隔
		
			 //更新连线坐标
			 svg_edges.attr("x1",function(d){ return d.source.x; })
			 		.attr("y1",function(d){ return d.source.y; })
			 		.attr("x2",function(d){ return d.target.x; })
			 		.attr("y2",function(d){ return d.target.y; });
			 
			 //更新节点坐标
			 svg_nodes.attr("cx",function(d){ return d.x; })
			 		.attr("cy",function(d){ return d.y; });

			 //更新文字坐标
			 svg_texts.attr("x", function(d){ return d.x; })
			 	.attr("y", function(d){ return d.y; });
		});

	    function highlightNode(node) {
            svg_edges.each(function (d) {
                this.style.stroke = "#ccc";
                this.style.opacity = "0.5";
                if (d.source.index == node || d.target.index == node) {
                    this.style.stroke = "red";
                    this.style.opacity = "0.9";
                }
            });
        }

		  
        </script>  
		
    </body>  
</html>  
